test_that("read_text_file()", {
  expect_equal({
    file <-
      system.file("extdata", "csvfolder/m1.csv", package = "flattabler")
    read_text_file(file)
  }, structure(
    list(
      df = structure(
        list(
          V1 = c(
            "M1",
            "",
            "B",
            "b1",
            "",
            "",
            "",
            "",
            "Total b1",
            "b4",
            "",
            "",
            "",
            "",
            "Total b4",
            "Total general"
          ),
          V2 = c(
            "",
            "",
            "A",
            "a01",
            "a05",
            "a09",
            "a13",
            "a17",
            "",
            "a04",
            "a08",
            "a12",
            "a16",
            "a20",
            "",
            ""
          ),
          V3 = c(
            "E",
            "e1",
            "d1",
            "",
            "1,91 ",
            "2,55 ",
            "2,99 ",
            "3,71 ",
            "11,16 ",
            "1,84 ",
            "1,69 ",
            "",
            "1,43 ",
            "2,70 ",
            "7,66 ",
            "18,82 "
          ),
          V4 = c(
            "D",
            "",
            "d2",
            "",
            "",
            "2,74 ",
            "1,02 ",
            "1,94 ",
            "5,70 ",
            "1,51 ",
            "1,01 ",
            "1,47 ",
            "1,97 ",
            "",
            "5,96 ",
            "11,66 "
          ),
          V5 = c(
            "",
            "Total e1",
            "",
            "",
            "1,91 ",
            "5,29 ",
            "4,01 ",
            "5,65 ",
            "16,86 ",
            "3,35 ",
            "2,70 ",
            "1,47 ",
            "3,40 ",
            "2,70 ",
            "13,62 ",
            "30,48 "
          ),
          V6 = c(
            "",
            "e2",
            "d3",
            "",
            "1,10 ",
            "3,99 ",
            "3,48 ",
            "3,84 ",
            "12,41 ",
            "5,37 ",
            "0,86 ",
            "3,46 ",
            "2,43 ",
            "2,18 ",
            "14,30 ",
            "26,71 "
          ),
          V7 = c(
            "",
            "",
            "d4",
            "1,88 ",
            "2,25 ",
            "",
            "2,18 ",
            "2,34 ",
            "8,65 ",
            "3,20 ",
            "1,73 ",
            "3,49 ",
            "2,22 ",
            "1,55 ",
            "12,19 ",
            "20,84 "
          ),
          V8 = c(
            "",
            "",
            "d5",
            "",
            "",
            "",
            "1,32 ",
            "2,13 ",
            "3,45 ",
            "4,89 ",
            "4,06 ",
            "1,54 ",
            "2,71 ",
            "3,32 ",
            "16,52 ",
            "19,97 "
          ),
          V9 = c(
            "",
            "Total e2",
            "",
            "1,88 ",
            "3,35 ",
            "3,99 ",
            "6,98 ",
            "8,31 ",
            "24,51 ",
            "13,46 ",
            "6,65 ",
            "8,49 ",
            "7,36 ",
            "7,05 ",
            "43,01 ",
            "67,52 "
          ),
          V10 = c(
            "",
            "Total general",
            "",
            "1,88 ",
            "5,26 ",
            "9,28 ",
            "10,99 ",
            "13,96 ",
            "41,37 ",
            "16,81 ",
            "9,35 ",
            "9,96 ",
            "10,76 ",
            "9,75 ",
            "56,63 ",
            "98,00 "
          )
        ),
        class = "data.frame",
        row.names = c(NA, 16L)
      ),
      page = "m1.csv",
      n_col_labels = 0,
      n_row_labels = 0
    ),
    class = "pivot_table"
  ))
})

test_that("read_text_folder()", {
  expect_equal({
    folder <-
      system.file("extdata", "csvfolder", package = "flattabler")
    read_text_folder(folder)
  }, list(
    structure(
      list(
        df = structure(
          list(
            V1 = c(
              "M1",
              "",
              "B",
              "b1",
              "",
              "",
              "",
              "",
              "Total b1",
              "b4",
              "",
              "",
              "",
              "",
              "Total b4",
              "Total general"
            ),
            V2 = c(
              "",
              "",
              "A",
              "a01",
              "a05",
              "a09",
              "a13",
              "a17",
              "",
              "a04",
              "a08",
              "a12",
              "a16",
              "a20",
              "",
              ""
            ),
            V3 = c(
              "E",
              "e1",
              "d1",
              "",
              "1,91 ",
              "2,55 ",
              "2,99 ",
              "3,71 ",
              "11,16 ",
              "1,84 ",
              "1,69 ",
              "",
              "1,43 ",
              "2,70 ",
              "7,66 ",
              "18,82 "
            ),
            V4 = c(
              "D",
              "",
              "d2",
              "",
              "",
              "2,74 ",
              "1,02 ",
              "1,94 ",
              "5,70 ",
              "1,51 ",
              "1,01 ",
              "1,47 ",
              "1,97 ",
              "",
              "5,96 ",
              "11,66 "
            ),
            V5 = c(
              "",
              "Total e1",
              "",
              "",
              "1,91 ",
              "5,29 ",
              "4,01 ",
              "5,65 ",
              "16,86 ",
              "3,35 ",
              "2,70 ",
              "1,47 ",
              "3,40 ",
              "2,70 ",
              "13,62 ",
              "30,48 "
            ),
            V6 = c(
              "",
              "e2",
              "d3",
              "",
              "1,10 ",
              "3,99 ",
              "3,48 ",
              "3,84 ",
              "12,41 ",
              "5,37 ",
              "0,86 ",
              "3,46 ",
              "2,43 ",
              "2,18 ",
              "14,30 ",
              "26,71 "
            ),
            V7 = c(
              "",
              "",
              "d4",
              "1,88 ",
              "2,25 ",
              "",
              "2,18 ",
              "2,34 ",
              "8,65 ",
              "3,20 ",
              "1,73 ",
              "3,49 ",
              "2,22 ",
              "1,55 ",
              "12,19 ",
              "20,84 "
            ),
            V8 = c(
              "",
              "",
              "d5",
              "",
              "",
              "",
              "1,32 ",
              "2,13 ",
              "3,45 ",
              "4,89 ",
              "4,06 ",
              "1,54 ",
              "2,71 ",
              "3,32 ",
              "16,52 ",
              "19,97 "
            ),
            V9 = c(
              "",
              "Total e2",
              "",
              "1,88 ",
              "3,35 ",
              "3,99 ",
              "6,98 ",
              "8,31 ",
              "24,51 ",
              "13,46 ",
              "6,65 ",
              "8,49 ",
              "7,36 ",
              "7,05 ",
              "43,01 ",
              "67,52 "
            ),
            V10 = c(
              "",
              "Total general",
              "",
              "1,88 ",
              "5,26 ",
              "9,28 ",
              "10,99 ",
              "13,96 ",
              "41,37 ",
              "16,81 ",
              "9,35 ",
              "9,96 ",
              "10,76 ",
              "9,75 ",
              "56,63 ",
              "98,00 "
            )
          ),
          class = "data.frame",
          row.names = c(NA, 16L)
        ),
        page = "m1.csv",
        n_col_labels = 0,
        n_row_labels = 0
      ),
      class = "pivot_table"
    ),
    structure(
      list(
        df = structure(
          list(
            V1 = c(
              "M2",
              "",
              "B",
              "b1",
              "",
              "",
              "",
              "",
              "Total b1",
              "b2",
              "",
              "",
              "",
              "",
              "Total b2",
              "b3",
              "",
              "",
              "",
              "",
              "Total b3",
              "b4",
              "",
              "",
              "",
              "",
              "Total b4",
              "Total general"
            ),
            V2 = c(
              "",
              "",
              "A",
              "a01",
              "a05",
              "a09",
              "a13",
              "a17",
              "",
              "a02",
              "a06",
              "a10",
              "a14",
              "a18",
              "",
              "a03",
              "a07",
              "a11",
              "a15",
              "a19",
              "",
              "a04",
              "a08",
              "a12",
              "a16",
              "a20",
              "",
              ""
            ),
            V3 = c(
              "E",
              "e1",
              "d1",
              "",
              "41",
              "16",
              "12",
              "9",
              "78",
              "10",
              "24",
              "6",
              "32",
              "20",
              "92",
              "4",
              "6",
              "7",
              "14",
              "23",
              "54",
              "9",
              "18",
              "",
              "10",
              "16",
              "53",
              "277"
            ),
            V4 = c(
              "D",
              "",
              "d2",
              "",
              "",
              "12",
              "12",
              "23",
              "47",
              "10",
              "15",
              "27",
              "8",
              "10",
              "70",
              "10",
              "",
              "5",
              "",
              "19",
              "34",
              "16",
              "15",
              "32",
              "18",
              "",
              "81",
              "232"
            ),
            V5 = c(
              "",
              "Total e1",
              "",
              "",
              "41",
              "28",
              "24",
              "32",
              "125",
              "20",
              "39",
              "33",
              "40",
              "30",
              "162",
              "14",
              "6",
              "12",
              "14",
              "42",
              "88",
              "25",
              "33",
              "32",
              "28",
              "16",
              "134",
              "509"
            ),
            V6 = c(
              "",
              "e2",
              "d3",
              "",
              "8",
              "13",
              "11",
              "5",
              "37",
              "34",
              "21",
              "16",
              "45",
              "10",
              "126",
              "14",
              "5",
              "17",
              "30",
              "14",
              "80",
              "7",
              "9",
              "10",
              "24",
              "4",
              "54",
              "297"
            ),
            V7 = c(
              "",
              "",
              "d4",
              "9",
              "22",
              "",
              "22",
              "24",
              "77",
              "29",
              "17",
              "7",
              "4",
              "12",
              "69",
              "8",
              "28",
              "",
              "17",
              "25",
              "78",
              "8",
              "27",
              "17",
              "8",
              "13",
              "73",
              "297"
            ),
            V8 = c(
              "",
              "",
              "d5",
              "",
              "",
              "",
              "7",
              "16",
              "23",
              "5",
              "7",
              "",
              "",
              "",
              "12",
              "8",
              "",
              "13",
              "13",
              "",
              "34",
              "10",
              "5",
              "9",
              "4",
              "5",
              "33",
              "102"
            ),
            V9 = c(
              "",
              "Total e2",
              "",
              "9",
              "30",
              "13",
              "40",
              "45",
              "137",
              "68",
              "45",
              "23",
              "49",
              "22",
              "207",
              "30",
              "33",
              "30",
              "60",
              "39",
              "192",
              "25",
              "41",
              "36",
              "36",
              "22",
              "160",
              "696"
            ),
            V10 = c(
              "",
              "Total general",
              "",
              "9",
              "71",
              "41",
              "64",
              "77",
              "262",
              "88",
              "84",
              "56",
              "89",
              "52",
              "369",
              "44",
              "39",
              "42",
              "74",
              "81",
              "280",
              "50",
              "74",
              "68",
              "64",
              "38",
              "294",
              "1205"
            )
          ),
          class = "data.frame",
          row.names = c(NA,
                        28L)
        ),
        page = "m2.csv",
        n_col_labels = 0,
        n_row_labels = 0
      ),
      class = "pivot_table"
    ),
    structure(
      list(
        df = structure(
          list(
            V1 = c(
              "M3",
              "",
              "B",
              "b1",
              "",
              "",
              "",
              "Total b1",
              "b2",
              "",
              "",
              "",
              "",
              "Total b2",
              "b3",
              "",
              "",
              "",
              "",
              "Total b3",
              "b4",
              "",
              "",
              "",
              "",
              "Total b4",
              "Total general"
            ),
            V2 = c(
              "",
              "",
              "A",
              "a05",
              "a09",
              "a13",
              "a17",
              "",
              "a02",
              "a06",
              "a10",
              "a14",
              "a18",
              "",
              "a03",
              "a07",
              "a11",
              "a15",
              "a19",
              "",
              "a04",
              "a08",
              "a12",
              "a16",
              "a20",
              "",
              ""
            ),
            V3 = c(
              "E",
              "e1",
              "d1",
              "78,31",
              "40,80",
              "35,88",
              "33,39",
              "188,38",
              "25,60",
              "63,60",
              "9,90",
              "40,32",
              "44,80",
              "184,22",
              "12,96",
              "13,98",
              "23,17",
              "42,98",
              "47,15",
              "140,24",
              "16,56",
              "30,42",
              "",
              "14,30",
              "43,20",
              "104,48",
              "617,32"
            ),
            V4 = c(
              "D",
              "",
              "d2",
              "",
              "32,88",
              "12,24",
              "44,62",
              "89,74",
              "45,10",
              "30,30",
              "25,11",
              "25,68",
              "27,20",
              "153,39",
              "26,70",
              "",
              "17,75",
              "",
              "53,77",
              "98,22",
              "24,16",
              "15,15",
              "47,04",
              "35,46",
              "",
              "121,81",
              "463,16"
            ),
            V5 = c(
              "",
              "Total e1",
              "",
              "78,31",
              "73,68",
              "48,12",
              "78,01",
              "278,12",
              "70,70",
              "93,90",
              "35,01",
              "66,00",
              "72,00",
              "337,61",
              "39,66",
              "13,98",
              "40,92",
              "42,98",
              "100,92",
              "238,46",
              "40,72",
              "45,57",
              "47,04",
              "49,76",
              "43,20",
              "226,29",
              "1.080,48"
            ),
            V6 = c(
              "",
              "Total general",
              "",
              "78,31",
              "73,68",
              "48,12",
              "78,01",
              "278,12",
              "70,70",
              "93,90",
              "35,01",
              "66,00",
              "72,00",
              "337,61",
              "39,66",
              "13,98",
              "40,92",
              "42,98",
              "100,92",
              "238,46",
              "40,72",
              "45,57",
              "47,04",
              "49,76",
              "43,20",
              "226,29",
              "1.080,48"
            )
          ),
          class = "data.frame",
          row.names = c(NA,
                        27L)
        ),
        page = "m3.csv",
        n_col_labels = 0,
        n_row_labels = 0
      ),
      class = "pivot_table"
    ),
    structure(
      list(
        df = structure(
          list(
            V1 = c(
              "M4",
              "",
              "B",
              "b1",
              "",
              "",
              "",
              "Total b1",
              "b2",
              "",
              "",
              "",
              "",
              "Total b2",
              "b3",
              "",
              "",
              "",
              "Total b3",
              "b4",
              "",
              "",
              "",
              "",
              "Total b4",
              "Total general"
            ),
            V2 = c(
              "",
              "",
              "A",
              "a05",
              "a09",
              "a13",
              "a17",
              "",
              "a02",
              "a06",
              "a10",
              "a14",
              "a18",
              "",
              "a03",
              "a07",
              "a15",
              "a19",
              "",
              "a04",
              "a08",
              "a12",
              "a16",
              "a20",
              "",
              ""
            ),
            V3 = c(
              "E",
              "e2",
              "d3",
              "70,40",
              "674,31",
              "421,08",
              "96,00",
              "1.261,79",
              "924,80",
              "1.058,40",
              "791,04",
              "4.698,00",
              "150,00",
              "7.622,24",
              "658,56",
              "92,00",
              "2.043,00",
              "393,96",
              "3.187,52",
              "263,13",
              "69,66",
              "346,00",
              "1.399,68",
              "34,88",
              "2.113,35",
              "14.184,90"
            ),
            V4 = c(
              "D",
              "",
              "d4",
              "1.089,00",
              "",
              "1.055,12",
              "1.347,84",
              "3.491,96",
              "1.867,02",
              "494,19",
              "121,03",
              "40,96",
              "443,52",
              "2.966,72",
              "203,52",
              "1.466,08",
              "184,96",
              "1.056,25",
              "2.910,81",
              "204,80",
              "1.261,17",
              "1.008,61",
              "142,08",
              "261,95",
              "2.878,61",
              "12.248,10"
            ),
            V5 = c(
              "",
              "",
              "d5",
              "",
              "",
              "64,68",
              "545,28",
              "609,96",
              "73,50",
              "139,65",
              "",
              "",
              "",
              "213,15",
              "148,48",
              "",
              "544,18",
              "",
              "692,66",
              "489,00",
              "101,50",
              "124,74",
              "43,36",
              "83,00",
              "841,60",
              "2.357,37"
            ),
            V6 = c(
              "",
              "Total e2",
              "",
              "1.159,40",
              "674,31",
              "1.540,88",
              "1.989,12",
              "5.363,71",
              "2.865,32",
              "1.692,24",
              "912,07",
              "4.738,96",
              "593,52",
              "10.802,11",
              "1.010,56",
              "1.558,08",
              "2.772,14",
              "1.450,21",
              "6.790,99",
              "956,93",
              "1.432,33",
              "1.479,35",
              "1.585,12",
              "379,83",
              "5.833,56",
              "28.790,37"
            ),
            V7 = c(
              "",
              "Total general",
              "",
              "1.159,40",
              "674,31",
              "1.540,88",
              "1.989,12",
              "5.363,71",
              "2.865,32",
              "1.692,24",
              "912,07",
              "4.738,96",
              "593,52",
              "10.802,11",
              "1.010,56",
              "1.558,08",
              "2.772,14",
              "1.450,21",
              "6.790,99",
              "956,93",
              "1.432,33",
              "1.479,35",
              "1.585,12",
              "379,83",
              "5.833,56",
              "28.790,37"
            )
          ),
          class = "data.frame",
          row.names = c(NA, 26L)
        ),
        page = "m4.csv",
        n_col_labels = 0,
        n_row_labels = 0
      ),
      class = "pivot_table"
    )
  ))
})
