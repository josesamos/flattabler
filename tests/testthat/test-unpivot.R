test_that("unpivot(), pivot_table", {
  expect_equal({
    pt_ex |>
      set_page(1, 1) |>
      remove_top(1) |>
      define_labels(n_col = 2, n_row = 2) |>
      remove_k() |>
      replace_dec() |>
      fill_values() |>
      fill_labels() |>
      remove_agg() |>
      unpivot(include_page = TRUE,
              na.rm = TRUE)
  }, structure(
    list(
      page = c(
        "M4",
        "M4",
        "M4",
        "M4",
        "M4",
        "M4",
        "M4",
        "M4",
        "M4",
        "M4",
        "M4",
        "M4",
        "M4",
        "M4",
        "M4",
        "M4",
        "M4",
        "M4",
        "M4",
        "M4",
        "M4",
        "M4",
        "M4",
        "M4",
        "M4",
        "M4",
        "M4",
        "M4",
        "M4",
        "M4",
        "M4",
        "M4",
        "M4",
        "M4",
        "M4",
        "M4",
        "M4",
        "M4",
        "M4",
        "M4",
        "M4",
        "M4",
        "M4",
        "M4",
        "M4",
        "M4"
      ),
      col1 = c(
        "b1",
        "b1",
        "b1",
        "b1",
        "b1",
        "b1",
        "b1",
        "b1",
        "b1",
        "b2",
        "b2",
        "b2",
        "b2",
        "b2",
        "b2",
        "b2",
        "b2",
        "b2",
        "b2",
        "b2",
        "b2",
        "b3",
        "b3",
        "b3",
        "b3",
        "b3",
        "b3",
        "b3",
        "b3",
        "b3",
        "b3",
        "b4",
        "b4",
        "b4",
        "b4",
        "b4",
        "b4",
        "b4",
        "b4",
        "b4",
        "b4",
        "b4",
        "b4",
        "b4",
        "b4",
        "b4"
      ),
      col2 = c(
        "a05",
        "a05",
        "a09",
        "a13",
        "a13",
        "a13",
        "a17",
        "a17",
        "a17",
        "a02",
        "a02",
        "a02",
        "a06",
        "a06",
        "a06",
        "a10",
        "a10",
        "a14",
        "a14",
        "a18",
        "a18",
        "a03",
        "a03",
        "a03",
        "a07",
        "a07",
        "a15",
        "a15",
        "a15",
        "a19",
        "a19",
        "a04",
        "a04",
        "a04",
        "a08",
        "a08",
        "a08",
        "a12",
        "a12",
        "a12",
        "a16",
        "a16",
        "a16",
        "a20",
        "a20",
        "a20"
      ),
      row1 = c(
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2"
      ),
      row2 = c(
        "d3",
        "d4",
        "d3",
        "d3",
        "d4",
        "d5",
        "d3",
        "d4",
        "d5",
        "d3",
        "d4",
        "d5",
        "d3",
        "d4",
        "d5",
        "d3",
        "d4",
        "d3",
        "d4",
        "d3",
        "d4",
        "d3",
        "d4",
        "d5",
        "d3",
        "d4",
        "d3",
        "d4",
        "d5",
        "d3",
        "d4",
        "d3",
        "d4",
        "d5",
        "d3",
        "d4",
        "d5",
        "d3",
        "d4",
        "d5",
        "d3",
        "d4",
        "d5",
        "d3",
        "d4",
        "d5"
      ),
      value = c(
        "70.40",
        "1089.00",
        "674.31",
        "421.08",
        "1055.12",
        "64.68",
        "96.00",
        "1347.84",
        "545.28",
        "924.80",
        "1867.02",
        "73.50",
        "1058.40",
        "494.19",
        "139.65",
        "791.04",
        "121.03",
        "4698.00",
        "40.96",
        "150.00",
        "443.52",
        "658.56",
        "203.52",
        "148.48",
        "92.00",
        "1466.08",
        "2043.00",
        "184.96",
        "544.18",
        "393.96",
        "1056.25",
        "263.13",
        "204.80",
        "489.00",
        "69.66",
        "1261.17",
        "101.50",
        "346.00",
        "1008.61",
        "124.74",
        "1399.68",
        "142.08",
        "43.36",
        "34.88",
        "261.95",
        "83.00"
      )
    ),
    class = c("tbl_df", "tbl",
              "data.frame"),
    row.names = c(NA,-46L)
  ))
})

test_that("unpivot(), pivot_table", {
  expect_equal({
    pt_ex |>
      set_page(1, 1) |>
      remove_top(1) |>
      define_labels(n_col = 2, n_row = 2) |>
      remove_k() |>
      replace_dec() |>
      fill_values() |>
      fill_labels() |>
      remove_agg() |>
      unpivot(include_page = FALSE,
              na.rm = FALSE)
  }, structure(
    list(
      col1 = c(
        "b1",
        "b1",
        "b1",
        "b1",
        "b1",
        "b1",
        "b1",
        "b1",
        "b1",
        "b1",
        "b1",
        "b1",
        "b2",
        "b2",
        "b2",
        "b2",
        "b2",
        "b2",
        "b2",
        "b2",
        "b2",
        "b2",
        "b2",
        "b2",
        "b2",
        "b2",
        "b2",
        "b3",
        "b3",
        "b3",
        "b3",
        "b3",
        "b3",
        "b3",
        "b3",
        "b3",
        "b3",
        "b3",
        "b3",
        "b4",
        "b4",
        "b4",
        "b4",
        "b4",
        "b4",
        "b4",
        "b4",
        "b4",
        "b4",
        "b4",
        "b4",
        "b4",
        "b4",
        "b4"
      ),
      col2 = c(
        "a05",
        "a05",
        "a05",
        "a09",
        "a09",
        "a09",
        "a13",
        "a13",
        "a13",
        "a17",
        "a17",
        "a17",
        "a02",
        "a02",
        "a02",
        "a06",
        "a06",
        "a06",
        "a10",
        "a10",
        "a10",
        "a14",
        "a14",
        "a14",
        "a18",
        "a18",
        "a18",
        "a03",
        "a03",
        "a03",
        "a07",
        "a07",
        "a07",
        "a15",
        "a15",
        "a15",
        "a19",
        "a19",
        "a19",
        "a04",
        "a04",
        "a04",
        "a08",
        "a08",
        "a08",
        "a12",
        "a12",
        "a12",
        "a16",
        "a16",
        "a16",
        "a20",
        "a20",
        "a20"
      ),
      row1 = c(
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2"
      ),
      row2 = c(
        "d3",
        "d4",
        "d5",
        "d3",
        "d4",
        "d5",
        "d3",
        "d4",
        "d5",
        "d3",
        "d4",
        "d5",
        "d3",
        "d4",
        "d5",
        "d3",
        "d4",
        "d5",
        "d3",
        "d4",
        "d5",
        "d3",
        "d4",
        "d5",
        "d3",
        "d4",
        "d5",
        "d3",
        "d4",
        "d5",
        "d3",
        "d4",
        "d5",
        "d3",
        "d4",
        "d5",
        "d3",
        "d4",
        "d5",
        "d3",
        "d4",
        "d5",
        "d3",
        "d4",
        "d5",
        "d3",
        "d4",
        "d5",
        "d3",
        "d4",
        "d5",
        "d3",
        "d4",
        "d5"
      ),
      value = c(
        "70.40",
        "1089.00",
        NA,
        "674.31",
        NA,
        NA,
        "421.08",
        "1055.12",
        "64.68",
        "96.00",
        "1347.84",
        "545.28",
        "924.80",
        "1867.02",
        "73.50",
        "1058.40",
        "494.19",
        "139.65",
        "791.04",
        "121.03",
        NA,
        "4698.00",
        "40.96",
        NA,
        "150.00",
        "443.52",
        NA,
        "658.56",
        "203.52",
        "148.48",
        "92.00",
        "1466.08",
        NA,
        "2043.00",
        "184.96",
        "544.18",
        "393.96",
        "1056.25",
        NA,
        "263.13",
        "204.80",
        "489.00",
        "69.66",
        "1261.17",
        "101.50",
        "346.00",
        "1008.61",
        "124.74",
        "1399.68",
        "142.08",
        "43.36",
        "34.88",
        "261.95",
        "83.00"
      )
    ),
    class = c("tbl_df", "tbl", "data.frame"),
    row.names = c(NA,-54L)
  ))
})

test_that("unpivot(), pivot_table", {
  expect_equal({
    pt_ex |>
      set_page(1, 1) |>
      remove_top(1) |>
      define_labels(n_col = 2, n_row = 2) |>
      remove_k() |>
      replace_dec() |>
      fill_values() |>
      fill_labels() |>
      remove_agg() |>
      unpivot(include_page = FALSE,
              na.rm = TRUE)
  }, structure(
    list(
      col1 = c(
        "b1",
        "b1",
        "b1",
        "b1",
        "b1",
        "b1",
        "b1",
        "b1",
        "b1",
        "b2",
        "b2",
        "b2",
        "b2",
        "b2",
        "b2",
        "b2",
        "b2",
        "b2",
        "b2",
        "b2",
        "b2",
        "b3",
        "b3",
        "b3",
        "b3",
        "b3",
        "b3",
        "b3",
        "b3",
        "b3",
        "b3",
        "b4",
        "b4",
        "b4",
        "b4",
        "b4",
        "b4",
        "b4",
        "b4",
        "b4",
        "b4",
        "b4",
        "b4",
        "b4",
        "b4",
        "b4"
      ),
      col2 = c(
        "a05",
        "a05",
        "a09",
        "a13",
        "a13",
        "a13",
        "a17",
        "a17",
        "a17",
        "a02",
        "a02",
        "a02",
        "a06",
        "a06",
        "a06",
        "a10",
        "a10",
        "a14",
        "a14",
        "a18",
        "a18",
        "a03",
        "a03",
        "a03",
        "a07",
        "a07",
        "a15",
        "a15",
        "a15",
        "a19",
        "a19",
        "a04",
        "a04",
        "a04",
        "a08",
        "a08",
        "a08",
        "a12",
        "a12",
        "a12",
        "a16",
        "a16",
        "a16",
        "a20",
        "a20",
        "a20"
      ),
      row1 = c(
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2",
        "e2"
      ),
      row2 = c(
        "d3",
        "d4",
        "d3",
        "d3",
        "d4",
        "d5",
        "d3",
        "d4",
        "d5",
        "d3",
        "d4",
        "d5",
        "d3",
        "d4",
        "d5",
        "d3",
        "d4",
        "d3",
        "d4",
        "d3",
        "d4",
        "d3",
        "d4",
        "d5",
        "d3",
        "d4",
        "d3",
        "d4",
        "d5",
        "d3",
        "d4",
        "d3",
        "d4",
        "d5",
        "d3",
        "d4",
        "d5",
        "d3",
        "d4",
        "d5",
        "d3",
        "d4",
        "d5",
        "d3",
        "d4",
        "d5"
      ),
      value = c(
        "70.40",
        "1089.00",
        "674.31",
        "421.08",
        "1055.12",
        "64.68",
        "96.00",
        "1347.84",
        "545.28",
        "924.80",
        "1867.02",
        "73.50",
        "1058.40",
        "494.19",
        "139.65",
        "791.04",
        "121.03",
        "4698.00",
        "40.96",
        "150.00",
        "443.52",
        "658.56",
        "203.52",
        "148.48",
        "92.00",
        "1466.08",
        "2043.00",
        "184.96",
        "544.18",
        "393.96",
        "1056.25",
        "263.13",
        "204.80",
        "489.00",
        "69.66",
        "1261.17",
        "101.50",
        "346.00",
        "1008.61",
        "124.74",
        "1399.68",
        "142.08",
        "43.36",
        "34.88",
        "261.95",
        "83.00"
      )
    ),
    class = c("tbl_df",
              "tbl", "data.frame"),
    row.names = c(NA,-46L)
  ))
})
